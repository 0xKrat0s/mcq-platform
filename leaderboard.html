<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard - MCQ Platform</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container" style="max-width: 700px; padding-top: 2rem;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Exam Leaderboard</h2>
                <a href="index.html" class="btn btn-outline btn-sm">Back to Home</a>
            </div>

            <div class="form-group">
                <label class="form-label" for="exam-code">Enter Exam Code</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="form-control" id="exam-code" placeholder="e.g., JAVA-TEST-01" style="text-transform: uppercase;">
                    <button class="btn btn-primary" onclick="loadLeaderboard()">View</button>
                </div>
            </div>

            <div id="alert-container"></div>

            <div id="leaderboard-container" class="hidden">
                <h3 id="exam-title-display" class="mb-3"></h3>

                <div class="table-responsive">
                    <table class="table leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Score</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="empty-state" class="empty-state hidden">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3>No Results Yet</h3>
                <p>Be the first to complete this exam!</p>
            </div>
        </div>
    </div>

    <!-- Load JS modules -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/api.js"></script>

    <script>
        function loadLeaderboard() {
            const examCode = document.getElementById('exam-code').value.trim().toUpperCase();
            const alertContainer = document.getElementById('alert-container');
            const leaderboardContainer = document.getElementById('leaderboard-container');
            const emptyState = document.getElementById('empty-state');

            if (!examCode) {
                alertContainer.innerHTML = '<div class="alert alert-warning">Please enter an exam code</div>';
                return;
            }

            alertContainer.innerHTML = '';
            leaderboardContainer.classList.add('hidden');
            emptyState.classList.add('hidden');

            // Get leaderboard from client-side API
            const data = api.getLeaderboard(examCode);

            if (!data.success) {
                alertContainer.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                return;
            }

            document.getElementById('exam-title-display').textContent = data.examTitle;

            if (data.leaderboard.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }

            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = data.leaderboard.map(entry => {
                let rankClass = '';
                if (entry.rank === 1) rankClass = 'rank-1';
                else if (entry.rank === 2) rankClass = 'rank-2';
                else if (entry.rank === 3) rankClass = 'rank-3';

                let rankDisplay = entry.rank;
                if (entry.rank === 1) rankDisplay = '&#129351;'; // Gold medal
                else if (entry.rank === 2) rankDisplay = '&#129352;'; // Silver medal
                else if (entry.rank === 3) rankDisplay = '&#129353;'; // Bronze medal

                return `
                    <tr class="${rankClass}">
                        <td><strong>${rankDisplay}</strong></td>
                        <td>${entry.name}</td>
                        <td>${entry.score}/${entry.totalMarks}</td>
                        <td>${entry.percentage}%</td>
                    </tr>
                `;
            }).join('');

            leaderboardContainer.classList.remove('hidden');
        }

        // Check if exam code is in URL or session
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code') || sessionStorage.getItem('examCode');
        if (code) {
            document.getElementById('exam-code').value = code;
            loadLeaderboard();
        }
    </script>
</body>
</html>
